<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Drawings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Fonts and Icons as in docs editor -->
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        * { font-family: "Mulish", sans-serif; box-sizing: border-box; }
        body { margin: 0; padding: 0; background: #f5f6fa; }
        .top-nav {
            height: 64px;
            background: #fff;
            border-bottom: 1.5px solid #eaeaea;
            display: flex;
            align-items: center;
            padding: 0 24px;
            font-size: 15px;
            color: #181a21;
            box-shadow: 0 2px 10px 0 rgba(0,0,0,0.03);
            position: relative;
            z-index: 10;
        }
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 36px;
        }
        .nav-brand img { height: 32px; width: 32px; }
        .nav-brand span {
            font-weight: 700;
            font-size: 20px;
            color: #23242b;
            letter-spacing: 0.05em;
        }
        .nav-menu { display: flex; gap: 8px; }
        .nav-item {
            padding: 10px 22px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 15px;
            border-radius: 7px;
            color: #24262d;
            font-weight: 500;
        }
        .nav-item:hover, .nav-item.active {
            background: #f8faff;
            color: #0078d4;
        }
        .main-container { display: flex; height: calc(100vh - 64px); }
        .left-nav {
            width: 270px;
            background: #fff;
            border-right: 1px solid #eaeaea;
            display: flex;
            flex-direction: column;
            font-size: 13px;
            color: #23242b;
        }
        .nav-header {
            padding: 12px 18px;
            background: #f7f7f9;
            border-bottom: 1px solid #eaeaea;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #888;
        }
        .nav-content { flex: 1; overflow-y: auto; }
        .nav-category { border-bottom: 1px solid #f1f1fa; }
        .category-header {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            min-height: 40px;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
            font-weight: 700;
            color: #181a21;
            background: #fff;
            border-bottom: 1px solid #f5f6fa;
            position: relative;
        }
        .category-header:hover { background: #f8faff; }
        .category-icon {
            font-size: 16px !important;
            margin-right: 8px;
            transition: transform 0.15s;
        }
        .category-header.collapsed .category-icon { transform: rotate(-90deg); }
        .category-plus-btn {
            margin-left: auto;
            color: #0078d4;
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 22px;
            transition: background 0.13s;
            border-radius: 50%;
            padding: 4px;
        }
        .category-plus-btn:hover { background: #e9f4ff; }
        .category-items {
            background: #fff;
            overflow: hidden;
            transition: max-height 0.2s ease;
            padding-bottom: 2px;
        }
        .category-items.collapsed { max-height: 0; padding-bottom: 0; }
        .nav-document-item {
            display: flex;
            align-items: center;
            padding: 8px 14px 8px 32px;
            min-height: 36px;
            cursor: pointer;
            font-size: 14px;
            color: #23242b;
            transition: background 0.15s;
            position: relative;
            border-radius: 6px;
            margin: 2px 6px;
            white-space: nowrap;
            overflow: hidden;
        }
        .nav-document-item:hover,
        .nav-document-item.active {
            background: #f8faff;
            color: #0078d4;
        }
        .nav-document-item .material-icons-outlined {
            font-size: 16px !important;
            margin-right: 8px;
            opacity: 0.8;
            flex-shrink: 0;
        }
        .drawing-title {
            flex: 1 1 auto;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block;
        }
        .drawing-dot-menu { margin-left: auto; position: relative; flex-shrink: 0; }
        .drawing-dot-btn {
            background: none;
            border: none;
            color: #bbb;
            font-size: 22px;
            height: 32px;
            width: 32px;
            min-width: 32px;
            min-height: 32px;
            max-width: 32px;
            max-height: 32px;
            padding: 0;
            margin-left: 6px;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.13s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .drawing-dot-btn .material-icons-outlined {
            margin: 0;
            font-size: 22px !important;
            line-height: 1;
            display: block;
        }
        .drawing-dot-btn:hover, .drawing-dot-btn.active {
            background: #e9f4ff;
            color: #0078d4;
        }
        .drawing-dot-dropdown {
            display: none;
            position: fixed;
            min-width: 145px;
            max-width: 180px;
            width: 170px;
            z-index: 9999;
            background: #fff;
            box-shadow: 0 4px 16px rgba(0,0,0,0.13);
            border-radius: 8px;
            padding: 4px 0;
            max-height: 100vh;
            overflow: auto;
        }
        .drawing-dot-dropdown.show { display: block; }
        .drawing-dot-dropdown button {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            font-size: 14px;
            padding: 6px 16px;
            color: #23242b;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            transition: background 0.13s;
            border-radius: 6px;
        }
        .drawing-dot-dropdown button:hover {
            background: #f4faff;
            color: #0078d4;
        }
        .drawing-dot-dropdown .material-icons-outlined { font-size: 18px !important; }
        .content-root {
            flex: 1;
            min-width: 0;
            background: #f5f6fa;
            position: relative;
            overflow: hidden;
        }
        #editorDiv, #noDrawingDiv {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #f5f6fa;
        }
        #editorDiv { display: none; }
        #noDrawingDiv {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .no-drawing-icon {
            font-size: 68px;
            color: #c4cad4;
            margin-bottom: 12px;
        }
        .no-drawing-title {
            font-size: 20px;
            font-weight: 700;
            color: #23242b;
            margin-bottom: 6px;
        }
        .no-drawing-desc {
            font-size: 15px;
            color: #6e7687;
            margin-bottom: 18px;
        }
        .no-drawing-btn {
            background: #0078d4;
            color: #fff;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            padding: 10px 25px;
            cursor: pointer;
            transition: background 0.16s;
        }
        .no-drawing-btn:hover {
            background: #005fa3;
        }
        .drawing-area-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #f5f6fa;
        }
        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            cursor: crosshair;
            z-index: 1;
        }
        .toolbar-bar {
            position: absolute;
            left: 0;
            width: 100vw;
            max-width: 100vw;
            min-width: 260px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            background: #f8faff;
            padding: 10px 24px;
            border-radius: 0 0 14px 14px;
            box-shadow: 0 2px 8px 0 rgba(0,0,0,0.04);
            gap: 10px;
            z-index: 10;
        }
        #topToolbar {
            top: 0;
            border-radius: 0 0 14px 14px;
        }
        #bottomToolbar {
            bottom: 0;
            border-radius: 14px 14px 0 0;
        }
        .toolbar-button {
            background: #e5e8ee;
            border: none;
            border-radius: 7px;
            height: 36px;
            width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s, box-shadow 0.15s;
            box-shadow: none;
            cursor: pointer;
            font-size: 20px;
        }
        .toolbar-button:hover {
            background: #cce4fd;
            box-shadow: 0 2px 5px 0 rgba(0,0,0,0.07);
        }
        #drawingName {
            width: 145px;
            padding: 7px 8px;
            outline: none;
            border-radius: 5px;
            border: 1px solid #ccc;
            cursor: text;
            font-size: 15px;
            background: #fff;
        }
        #statusText {
            font-weight: bold;
            color: red;
            width: 98px;
            text-align: center;
            font-size: 14px;
        }
        #colorPicker {
            opacity:0;
            height:0px;
            width:0px;
            margin:0;
            border:none;
            outline:none;
            padding:0;
        }
        #fakeColorPicker {
            border-radius: 7px;
            border:none;
            outline:none;
            background: #000;
            height: 30px;
            width: 30px;
            margin-right:6px;
            display:inline-block;
            cursor:pointer;
            border: 2px solid #e5e8ee;
        }
        #penSize {
            height: 30px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="top-nav">
        <div class="nav-brand">
            <img src="images/shapes.png" alt="Icon">
            <span>Drawings</span>
        </div>
        <div class="nav-menu">
            <div class="nav-item">Home</div>
            <div class="nav-item">Apps</div>
            <div class="nav-item">Profile</div>
            <div class="nav-item">Account</div>
        </div>
    </div>
    <div class="main-container">
        <div class="left-nav">
            <div class="nav-header">Workspace</div>
            <div class="nav-content">
                <div class="nav-category">
                    <div class="category-header" onclick="toggleCategory('drawings')" id="drawings-category-header">
                        <span class="material-icons-outlined category-icon">expand_more</span>
                        Drawings
                        <button class="category-plus-btn" title="New Drawing" onclick="event.stopPropagation();newDrawing();">
                            <span class="material-icons-outlined">add</span>
                        </button>
                    </div>
                    <div class="category-items" id="drawings-category">
                        <div id="drawing-list"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-root">
            <div id="noDrawingDiv">
                <span class="material-icons-outlined no-drawing-icon">draw</span>
                <div class="no-drawing-title">No Drawing Selected</div>
                <div class="no-drawing-desc">Pick a drawing from the left, or create a new one to get started.</div>
                <button class="no-drawing-btn" onclick="newDrawing()">New Drawing</button>
            </div>
            <div id="editorDiv">
                <div class="drawing-area-container">
                    <div id="topToolbar" class="toolbar-bar">
                  <!--     <button onclick="goHome()" class="toolbar-button" title="Home"><span class="material-icons-outlined">home</span></button> -->
                        <input type="text" id="drawingName" placeholder="Untitled drawing">
                        <button onclick="deleteDrawing()" class="toolbar-button" title="Delete"><span class="material-icons-outlined">delete</span></button>
                        <button onclick="saveDrawing()" class="toolbar-button" title="Save"><span class="material-icons-outlined">save</span></button>
                        <button onclick="downloadDrawing()" class="toolbar-button" title="Download"><span class="material-icons-outlined">download</span></button>
                        <span id="statusText">Not Saved</span>
                    </div>
                    <canvas id="canvas"></canvas>
                    <div id="bottomToolbar" class="toolbar-bar">
                        <input type="color" id="colorPicker" value="#000000">
                        <div id="fakeColorPicker" onclick="colorPick()" title="Pick Color"></div>
                        <input type="range" id="penSize" min="1" max="100" value="2" title="Pen Size">
                        <button onclick="toggleEraser()" id="eraser" class="toolbar-button" title="Eraser"><span class="material-icons-outlined">ink_eraser</span></button>
                        <button onclick="clearCanvas()" class="toolbar-button" title="Clear Canvas"><span class="material-icons-outlined">layers_clear</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function toggleCategory(categoryName) {
            const header = document.getElementById(`${categoryName}-category-header`);
            const category = document.getElementById(`${categoryName}-category`);
            header.classList.toggle('collapsed');
            category.classList.toggle('collapsed');
            if (category.classList.contains('collapsed')) {
                category.style.maxHeight = "0px";
            } else {
                category.style.maxHeight = category.scrollHeight + "px";
            }
        }

        let currentDrawingId = null;
        let drawingNameInput = document.getElementById("drawingName");
        let statusText = document.getElementById("statusText");
        let editorDiv = document.getElementById("editorDiv");
        let noDrawingDiv = document.getElementById("noDrawingDiv");

        function updateDrawingList() {
            const drawingList = document.getElementById("drawing-list");
            drawingList.innerHTML = "";
            let keys = Object.keys(localStorage).filter(k => k.startsWith("drawing_") && !k.endsWith("_paths"));
            keys.forEach(id => {
                let name = id.replace("drawing_", "");
                let item = document.createElement("div");
                item.className = "nav-document-item" + (id === currentDrawingId ? " active" : "");
                item.onclick = (e) => {
                    if (e.target.closest('.drawing-dot-btn') || e.target.closest('.drawing-dot-dropdown')) return;
                    selectDrawing(id);
                };
                item.innerHTML = `
                    <span class="material-icons-outlined">draw</span>
                    <span class="drawing-title">${name || "Untitled drawing"}</span>
                    <span class="drawing-dot-menu">
                        <button class="drawing-dot-btn" onclick="event.stopPropagation();toggleDrawingDotMenu('${id}', this)">
                            <span class="material-icons-outlined">more_horiz</span>
                        </button>
                        <div class="drawing-dot-dropdown" id="drawing-dot-dropdown-${id}">
                            <button onclick="event.stopPropagation();deleteDrawing('${id}')"><span class="material-icons-outlined">delete</span> Delete</button>
                        </div>
                    </span>
                `;
                drawingList.appendChild(item);
            });
        }
        function toggleDrawingDotMenu(id, btn) {
            closeAllDrawingDotMenus();
            let menu = document.getElementById("drawing-dot-dropdown-" + id);
            if (menu) {
                menu.classList.add("show");
                let rect = btn.getBoundingClientRect();
                let top = rect.bottom + 4;
                let left = rect.right - menu.offsetWidth;
                if (top + menu.offsetHeight > window.innerHeight) {
                    top = rect.top - menu.offsetHeight - 4;
                }
                menu.style.top = top + "px";
                menu.style.left = left + "px";
            }
            setTimeout(() => {
                document.addEventListener('mousedown', function clickAway(e) {
                    if (!e.target.closest('.drawing-dot-menu')) closeAllDrawingDotMenus();
                }, {capture:true, once:true});
            }, 10);
        }
        function closeAllDrawingDotMenus() {
            document.querySelectorAll('.drawing-dot-dropdown.show').forEach(m => m.classList.remove('show'));
        }
        function selectDrawing(id) {
            currentDrawingId = id;
            loadDrawing(id);
            updateDrawingList();
            showEditorOrNoDrawing();
        }

        let canvas = document.getElementById("canvas");
        let ctx = canvas.getContext("2d");
        let colorPicker = document.getElementById("colorPicker");
        let fakeColorPicker = document.getElementById("fakeColorPicker");
        let penSize = document.getElementById("penSize");
        let eraserActive = false;
        let lastColor = "#000000";
        let drawing = false;
        let autoSaveTimer = null;

        function autoSave() {
            if (!currentDrawingId) return;
            localStorage.setItem(currentDrawingId, JSON.stringify(drawnPaths));
            setStatus(true);
            updateDrawingList();
        }

        function setStatus(saved) {
            statusText.textContent = saved ? "Saved" : "Not Saved";
            statusText.style.color = saved ? "green" : "red";
        }

        let drawnPaths = [];
        let currentPath = null;
        function getCanvasRelative(e) {
            let rect = canvas.getBoundingClientRect();
            let x, y;
            if (e.touches && e.touches.length > 0) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }
            return { x: x / rect.width, y: y / rect.height };
        }
        function startDrawing(e) {
            drawing = true;
            currentPath = {
                points: [],
                color: colorPicker.value,
                lineWidth: parseFloat(penSize.value)
            };
            currentPath.points.push(getCanvasRelative(e));
            e.preventDefault();
        }
        function draw(e) {
            if (!drawing) return;
            let pt = getCanvasRelative(e);
            currentPath.points.push(pt);
            drawnPaths.push(currentPath);
            redrawPaths();
            drawnPaths.pop();
            setStatus(false);
            if (autoSaveTimer) clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(autoSave, 800);
            e.preventDefault();
        }
        function stopDrawing(e) {
            if (drawing && currentPath) {
                drawnPaths.push(currentPath);
                currentPath = null;
                setStatus(false);
                autoSave();
            }
            drawing = false;
        }
        function redrawPaths() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawnPaths.forEach(path => {
                if (path.points.length > 0) {
                    ctx.strokeStyle = path.color;
                    ctx.lineWidth = path.lineWidth;
                    ctx.beginPath();
                    ctx.moveTo(path.points[0].x * canvas.width, path.points[0].y * canvas.height);
                    for (let i = 1; i < path.points.length; i++) {
                        ctx.lineTo(path.points[i].x * canvas.width, path.points[i].y * canvas.height);
                    }
                    ctx.stroke();
                }
            });
        }
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.lineCap = "round"; ctx.lineJoin = "round";
            if (drawnPaths.length > 0) redrawPaths();
        }
        window.addEventListener("resize", resizeCanvas);

        document.addEventListener("DOMContentLoaded", function () {
            fakeColorPicker.style.backgroundColor = colorPicker.value;
            colorPicker.addEventListener("input", function () {
                fakeColorPicker.style.backgroundColor = colorPicker.value;
            });
            colorPicker.addEventListener("change", function () {
                fakeColorPicker.style.backgroundColor = colorPicker.value;
            });
        });
        function colorPick() { colorPicker.click(); }
        function toggleEraser() {
            eraserActive = !eraserActive;
            if (eraserActive) {
                lastColor = colorPicker.value;
                colorPicker.value = "#FFFFFF";
                fakeColorPicker.style.backgroundColor = "white";
            } else {
                colorPicker.value = lastColor;
                fakeColorPicker.style.backgroundColor = lastColor;
            }
            setStatus(false);
            autoSave();
        }
        function clearCanvas() {
            if (confirm("Are you sure you want to clear the canvas?")) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawnPaths = [];
                setStatus(false);
                autoSave();
            }
        }
        function goHome() {}
        function saveDrawing() {
            if (!currentDrawingId) return;
            localStorage.setItem(currentDrawingId, JSON.stringify(drawnPaths));
            setStatus(true);
            updateDrawingList();
        }
        function downloadDrawing() {
            let exportCanvas = document.createElement('canvas');
            exportCanvas.width = canvas.width;
            exportCanvas.height = canvas.height;
            let exportCtx = exportCanvas.getContext('2d');
            drawnPaths.forEach(path => {
                if (path.points.length > 0) {
                    exportCtx.strokeStyle = path.color;
                    exportCtx.lineWidth = path.lineWidth;
                    exportCtx.beginPath();
                    exportCtx.moveTo(path.points[0].x * exportCanvas.width, path.points[0].y * exportCanvas.height);
                    for (let i = 1; i < path.points.length; i++) {
                        exportCtx.lineTo(path.points[i].x * exportCanvas.width, path.points[i].y * exportCanvas.height);
                    }
                    exportCtx.stroke();
                }
            });
            let link = document.createElement("a");
            let title = drawingNameInput.value.trim() || "drawing";
            link.download = title + ".png";
            link.href = exportCanvas.toDataURL();
            link.click();
        }
        function deleteDrawing(id=null) {
            let delId = id || currentDrawingId;
            if (!delId) return;
            if (confirm("Are you sure you want to delete this drawing?")) {
                localStorage.removeItem(delId);
                if (delId === currentDrawingId) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    drawnPaths = [];
                    drawingNameInput.value = "";
                    currentDrawingId = null;
                }
                updateDrawingList();
                showEditorOrNoDrawing();
            }
        }
        function newDrawing() {
            let name = "Untitled " + (Object.keys(localStorage).filter(k=>k.startsWith("drawing_")).length + 1);
            let id = "drawing_" + name;
            currentDrawingId = id;
            drawnPaths = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawingNameInput.value = name;
            saveDrawing();
            updateDrawingList();
            showEditorOrNoDrawing();
        }
        function loadDrawing(id) {
            currentDrawingId = id;
            drawnPaths = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let json = localStorage.getItem(id);
            if (json && json.trim().startsWith("[")) {
                try {
                    drawnPaths = JSON.parse(json);
                    redrawPaths();
                } catch {}
            }
            drawingNameInput.value = id.replace("drawing_", "");
            setStatus(true);
        }
        function showEditorOrNoDrawing() {
            if (currentDrawingId) {
                editorDiv.style.display = "block";
                noDrawingDiv.style.display = "none";
            } else {
                editorDiv.style.display = "none";
                noDrawingDiv.style.display = "flex";
            }
        }
        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseleave", stopDrawing);
        canvas.addEventListener("touchstart", startDrawing);
        canvas.addEventListener("touchmove", draw);
        canvas.addEventListener("touchend", stopDrawing);
        canvas.addEventListener("touchcancel", stopDrawing);

        drawingNameInput.addEventListener("input", function () {
            if (!currentDrawingId) return;
            let prevId = currentDrawingId;
            let newName = drawingNameInput.value.trim() || "Untitled";
            let newId = "drawing_" + newName;
            if (prevId !== newId) {
                let data = localStorage.getItem(prevId);
                if (data) {
                    localStorage.setItem(newId, data);
                    localStorage.removeItem(prevId);
                }
                currentDrawingId = newId;
            }
            updateDrawingList();
            document.title = `${drawingNameInput.value} | Drawings`;
            autoSave();
        });

        window.addEventListener("DOMContentLoaded", function() {
            resizeCanvas();
            updateDrawingList();
            showEditorOrNoDrawing();
            document.title = "Drawings";
        });
    </script>
</body>
</html>
